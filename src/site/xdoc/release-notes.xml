<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 2025 Bloomreach

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//Apache Software Foundation//DTD XDOC 1.0//EN"
  "http://maven.apache.org/dtd/xdoc_1_0.dtd">
<document>
  <properties>
    <title>Release Notes</title>
  </properties>
  <body>

    <section name="Release Notes">

      <subsection name="Version 1.0.5">
        <p><strong>brXM Compatibility:</strong> 16.x</p>

        <h4>Security</h4>
        <ul>
          <li>XXE hardening: all <code>DocumentBuilderFactory</code> instances now disable
              external general entities, external parameter entities, and doctype declarations.
              Applies to <code>PomParser</code> (manifest-generator), <code>PomDependencyScanner</code>,
              and <code>AddonInstallationService</code></li>
          <li>XML injection prevention: <code>PomDependencyInjector</code> now escapes
              <code>&amp;</code>, <code>&lt;</code>, <code>&gt;</code>, <code>"</code>,
              <code>'</code> in all values interpolated into POM XML (dependency coordinates,
              property names/values)</li>
          <li>URL validation hardening: <code>SourceResource.isValidUrl()</code> now requires
              a non-null host for <code>http</code>/<code>https</code> URLs, rejecting
              malformed URLs like <code>http:///</code></li>
          <li>Audit logging: creating a source with a <code>file://</code> URL now emits a
              WARN-level log for traceability</li>
          <li>Symlink protection: <code>FilesystemPomFileWriter</code> rejects symlinks before
              write, backup, and restore operations to prevent symlink-following attacks</li>
        </ul>

        <h4>Performance</h4>
        <ul>
          <li>Reduced lock contention: <code>EssentialsAddonService.doLoadAddons()</code> now
              performs HTTP fetches outside the <code>synchronized</code> block, preventing
              thread starvation during slow network requests</li>
          <li>Eliminated per-call <code>DocumentBuilderFactory</code> creation in
              <code>PomDependencyScanner</code> and <code>AddonInstallationService</code>
              by extracting to <code>private static final</code> fields configured once at
              class load</li>
        </ul>
      </subsection>

      <subsection name="Version 1.0.4">
        <p><strong>brXM Compatibility:</strong> 16.x</p>

        <h4>Features</h4>
        <ul>
          <li>Misconfiguration detection: the Marketplace now detects addons with dependencies
              placed in the wrong POM, with incorrect scope, or duplicated across POM files.
              Misconfigured addons are surfaced in the project context and highlighted in the UI
              with a dedicated "Misconfigured" filter</li>
          <li>Fix installation endpoint: <code>POST /addons/{id}/fix</code> automatically
              corrects detected placement issues (moves dependencies to the correct POM,
              fixes scopes, removes duplicates)</li>
          <li>Project context now includes <code>misconfiguredAddons</code> map with per-addon
              <code>PlacementIssue</code> details (actual/expected POM, scope mismatch, duplicates)</li>
        </ul>

        <h4>Security</h4>
        <ul>
          <li>XXE protection: POM XML parsing now disables external entity processing
              via <code>disallow-doctype-decl</code></li>
        </ul>

        <h4>Improvements</h4>
        <ul>
          <li>Installation plan model: <code>InstallationPlan</code> record with sealed
              <code>DependencyChange</code> and <code>PropertyChange</code> types for
              type-safe installation planning</li>
          <li>Immutable project context: <code>ProjectContext</code> maps are now wrapped
              with <code>Collections.unmodifiableMap()</code></li>
          <li>Narrowed exception handling in <code>FilesystemPomFileReader</code>
              (<code>IOException</code> instead of <code>Exception</code>)</li>
          <li>DRY refactoring in <code>PomDependencyInjector</code>: extracted shared
              insert/pattern-building helpers and promoted regex patterns to static fields</li>
          <li>Decomposed <code>MisconfigurationDetector.detectForAddon()</code> into
              focused <code>checkPlacement()</code> and <code>checkDuplicates()</code> methods</li>
          <li>Extracted <code>executeOrThrow()</code> helper in <code>MarketplaceResource</code>
              to eliminate repeated validation/execution boilerplate</li>
          <li>Index-based addon lookup in <code>InstalledAddonMatcher</code> replacing
              O(n*m) nested loops with O(1) map lookups</li>
        </ul>
      </subsection>

      <subsection name="Version 1.0.3">
        <p><strong>brXM Compatibility:</strong> 16.x</p>

        <h4>Improvements</h4>
        <ul>
          <li>Auto-register Marketplace REST endpoints via Essentials plugin framework:
              REST classes are now declared in <code>plugin-descriptor.json</code> and mounted
              on the dynamic CXF server, eliminating the need for consumers to override
              <code>applicationContext.xml</code></li>
          <li>Added <code>SourceResource</code> to <code>restClasses</code> in plugin descriptor</li>
          <li>Updated JS frontend to use <code>rest/dynamic/marketplace</code> base path</li>
          <li>Removed manual <code>applicationContext.xml</code> from demo project</li>
          <li>Updated installation and architecture documentation</li>
        </ul>
      </subsection>

      <subsection name="Version 1.0.2">
        <p><strong>brXM Compatibility:</strong> 16.x</p>

        <h4>Features</h4>
        <ul>
          <li>Multi-artifact addon support: addons can now declare multiple Maven artifacts
              with distinct deployment targets and scopes in <code>addon-config.yaml</code></li>
          <li>New <code>ConfigArtifact</code> model for explicit per-artifact configuration
              (artifactId, target, scope, description)</li>
          <li>Schema updated with <code>artifacts</code> array including scope and description fields</li>
          <li>Installation service handles multi-artifact addons</li>
        </ul>

        <h4>Improvements</h4>
        <ul>
          <li>Descriptor generator produces multi-artifact descriptors from config</li>
          <li>Updated documentation: addon descriptor spec, auto-generation guide, CLI tools,
              user docs, and README</li>
          <li>Updated <code>addon-config.yaml</code> template with multi-artifact examples</li>
        </ul>
      </subsection>

      <subsection name="Version 1.0.1">
        <p><strong>brXM Compatibility:</strong> 16.x</p>

        <h4>Improvements</h4>
        <ul>
          <li>Prefer master/main branch over default for manifest generation</li>
          <li>Remove self-referencing forge-addon.yaml from marketplace project</li>
          <li>CI workflow and version alignment fixes</li>
        </ul>
      </subsection>

      <subsection name="Version 1.0.0">
        <p><strong>Release Date:</strong> TBD</p>
        <p><strong>brXM Compatibility:</strong> 16.x</p>

        <h4>Features</h4>
        <ul>
          <li>Initial release of Bloomreach Forge Marketplace</li>
          <li>Essentials plugin for browsing and discovering Forge addons</li>
          <li>Multi-source manifest aggregation</li>
          <li>REST API for addon discovery and source management</li>
          <li>Addon installation and uninstallation from Essentials UI</li>
          <li>POM backup and restore for safe installations</li>
          <li>XML validation before writing POM files</li>
          <li>Detailed error messages with specific error codes</li>
          <li>Partial uninstall warnings when artifacts cannot be removed</li>
          <li>CLI tools for addon developers:
            <ul>
              <li><code>descriptor-generator</code> - Generate forge-addon.yaml</li>
              <li><code>manifest-generator</code> - Generate addons-index.json</li>
            </ul>
          </li>
          <li>Schema validation for addon descriptors</li>
          <li>Configurable caching with TTL</li>
        </ul>

        <h4>Requirements</h4>
        <ul>
          <li>brXM 16.0.0 or higher</li>
          <li>Java 17 or higher</li>
        </ul>
      </subsection>

    </section>

  </body>
</document>
