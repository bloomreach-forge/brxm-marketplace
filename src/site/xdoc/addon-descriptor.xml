<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 2025 Bloomreach

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//Apache Software Foundation//DTD XDOC 1.0//EN"
  "http://maven.apache.org/dtd/xdoc_1_0.dtd">
<document>
  <properties>
    <title>Creating Addon Descriptors</title>
  </properties>
  <body>

    <section name="Creating Addon Descriptors">

      <subsection name="Overview">
        <p>
          To publish your addon to the Marketplace, create a <code>forge-addon.yaml</code> file
          in your repository root. This descriptor contains metadata about your addon including
          name, version, compatibility, and installation instructions.
        </p>
        <p>
          There are two approaches:
        </p>
        <ul>
          <li><strong>Auto-generation</strong> (recommended) - Use the descriptor-generator CLI tool</li>
          <li><strong>Manual</strong> - Write the YAML file by hand</li>
        </ul>
      </subsection>

      <subsection name="Descriptor Schema">
        <p>
          The <code>forge-addon.yaml</code> file follows this structure:
        </p>
        <source><![CDATA[
schemaVersion: "1.0"
id: my-addon
name: My Addon
description: A brief description of what this addon does
vendor: My Company
category: integration
documentationUrl: https://github.com/myorg/my-addon
license: Apache-2.0

compatibility:
  minBrxmVersion: "16.0.0"
  maxBrxmVersion: "16.99.99"

artifacts:
  - type: maven-lib
    maven:
      groupId: com.mycompany
      artifactId: my-addon
      version: "1.0.0"
    targets: [cms]

installationSteps:
  - type: maven
    description: Add dependency to cms/pom.xml
    xml: |
      <dependency>
        <groupId>com.mycompany</groupId>
        <artifactId>my-addon</artifactId>
        <version>1.0.0</version>
      </dependency>
        ]]></source>
      </subsection>

      <subsection name="Required Fields">
        <table>
          <tr>
            <th>Field</th>
            <th>Description</th>
          </tr>
          <tr>
            <td><code>schemaVersion</code></td>
            <td>Always "1.0"</td>
          </tr>
          <tr>
            <td><code>id</code></td>
            <td>Unique identifier (lowercase, hyphens allowed)</td>
          </tr>
          <tr>
            <td><code>name</code></td>
            <td>Display name</td>
          </tr>
          <tr>
            <td><code>description</code></td>
            <td>Brief description of the addon</td>
          </tr>
          <tr>
            <td><code>vendor</code></td>
            <td>Organization or author name</td>
          </tr>
          <tr>
            <td><code>category</code></td>
            <td>One of: integration, cms, site, security, content, search, other</td>
          </tr>
          <tr>
            <td><code>license</code></td>
            <td>SPDX license identifier (e.g., Apache-2.0, MIT)</td>
          </tr>
        </table>
      </subsection>

      <subsection name="Categories">
        <table>
          <tr>
            <th>Category</th>
            <th>Description</th>
          </tr>
          <tr>
            <td><code>integration</code></td>
            <td>Third-party integrations (analytics, DAM, etc.)</td>
          </tr>
          <tr>
            <td><code>cms</code></td>
            <td>CMS UI extensions and plugins</td>
          </tr>
          <tr>
            <td><code>site</code></td>
            <td>Site/delivery tier components</td>
          </tr>
          <tr>
            <td><code>security</code></td>
            <td>Authentication, authorization, security</td>
          </tr>
          <tr>
            <td><code>content</code></td>
            <td>Content management utilities</td>
          </tr>
          <tr>
            <td><code>search</code></td>
            <td>Search enhancements</td>
          </tr>
          <tr>
            <td><code>other</code></td>
            <td>Miscellaneous</td>
          </tr>
        </table>
      </subsection>

      <subsection name="Artifact Configuration">
        <p>
          Each artifact in the <code>artifacts</code> array specifies where and how a dependency should be added:
        </p>

        <h4>Target Values</h4>
        <table>
          <tr>
            <th>Target</th>
            <th>Typical pom.xml location</th>
          </tr>
          <tr>
            <td><code>parent</code></td>
            <td>Root pom.xml (dependencyManagement)</td>
          </tr>
          <tr>
            <td><code>cms</code></td>
            <td>cms/pom.xml</td>
          </tr>
          <tr>
            <td><code>site/components</code></td>
            <td>site/components/pom.xml (default)</td>
          </tr>
          <tr>
            <td><code>site/webapp</code></td>
            <td>site/webapp/pom.xml</td>
          </tr>
          <tr>
            <td><code>platform</code></td>
            <td>Platform module pom.xml</td>
          </tr>
        </table>

        <h4>Scope Values</h4>
        <table>
          <tr>
            <th>Scope</th>
            <th>Description</th>
          </tr>
          <tr>
            <td><code>compile</code></td>
            <td>Default scope, available at compile and runtime</td>
          </tr>
          <tr>
            <td><code>provided</code></td>
            <td>Expected to be provided by the container</td>
          </tr>
          <tr>
            <td><code>runtime</code></td>
            <td>Only needed at runtime, not compile time</td>
          </tr>
          <tr>
            <td><code>test</code></td>
            <td>Only for test compilation and execution</td>
          </tr>
        </table>

        <h4>Multi-Artifact Example</h4>
        <source><![CDATA[
artifacts:
  - type: maven-lib
    target: cms
    scope: compile
    description: "CMS integration module"
    maven:
      groupId: com.mycompany
      artifactId: my-addon-cms

  - type: maven-lib
    target: site/components
    scope: compile
    description: "Site components library"
    maven:
      groupId: com.mycompany
      artifactId: my-addon-site
        ]]></source>
      </subsection>

      <subsection name="Installation Steps">
        <p>
          Provide clear installation instructions for users:
        </p>
        <source><![CDATA[
installationSteps:
  - type: maven
    description: Add dependency to cms/pom.xml
    xml: |
      <dependency>
        <groupId>com.mycompany</groupId>
        <artifactId>my-addon</artifactId>
        <version>1.0.0</version>
      </dependency>

  - type: manual
    description: Configure the addon in application.yaml
    content: |
      Add the following to your application.yaml:

      myaddon:
        enabled: true
        apiKey: ${MYADDON_API_KEY}
        ]]></source>
      </subsection>

      <subsection name="Schema Validation">
        <p>
          The descriptor is validated against a JSON Schema. The schema is available at:
        </p>
        <source><![CDATA[
common/src/main/resources/forge-addon.schema.json
        ]]></source>
        <p>
          Use the descriptor-generator CLI tool which validates automatically, or validate manually
          with any JSON Schema validator.
        </p>
      </subsection>

    </section>

  </body>
</document>
